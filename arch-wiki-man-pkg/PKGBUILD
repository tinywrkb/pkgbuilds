# Maintainer: tinywrkb <tinywrkb@gmail.com>

_pkgname=arch-wiki-man
pkgname=${_pkgname}-pkg
pkgver=1.3.0
pkgrel=1
pkgdesc=''
arch=(x86_64)
url="https://github.com/greg-js/${_pkgname}"
license=()
makedepends=(nodejs npm git)
source=("${_pkgname}::git+${url}.git#tag=v${pkgver}"
		pkg.patch)
sha256sums=('SKIP' 'SKIP')
options=('!strip')

prepare() {
  export NPM_CONFIG_CACHE="${srcdir}"/npm-cache
  export NPM_CONFIG_DEVDIR="${srcdir}"/node-gyp
  export NPM_CONFIG_PREFIX="${srcdir}"/node
  export PKG_CACHE_PATH="${srcdir}"/pkg-cache
  export NODE_PATH="${srcdir}"/node/lib/node_modules:"${NODE_PATH}"
  export PATH="${srcdir}"/node/bin:"${PATH}"
  npm install -g pkg

  cd  ${_pkgname}
  patch -Np1 -i "${srcdir}"/pkg.patch
}

build() {
  cd  ${_pkgname}
  mkdir -p build
  npm install
  pkg -t node12-linux-x64 --output build/awman -c package.json bin/find.js
}

package() {
  cd  ${_pkgname}
  install -Dm755 build/awman "${pkgdir}"/usr/bin/awman
  install -Dm644 README.md "${pkgdir}"/usr/share/doc/${pkgname}/README.md
  install -Dm644 LICENSE.md "${pkgdir}"/usr/share/licenses/${pkgname}/LICENSE.md
}
