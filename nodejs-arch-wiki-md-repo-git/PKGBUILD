# Maintainer: tinywrkb <tinywrkb@gmail.com>

_gitname=arch-wiki-md-repo
pkgname=nodejs-${_gitname}-git
pkgver=0.10.262.r0.g5d5d064e7
pkgrel=1
pkgdesc='All arch-wiki articles in markdown format, updated every week'
arch=(any)
url="https://github.com/greg-js/${_gitname}"
license=('GFDL v1.3')
#makedepends=(jq nodejs npm)
makedepends=(git rsync)
source=("${_gitname}::git+${url}.git")
sha256sums=('SKIP')
options=('!strip')

pkgver() {
  cd ${_gitname}
  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g' | sed 's/^v//'
}

package() {
#  npm pack ${_gitname}/
#  npm install -g --prefix "${pkgdir}/usr" ${_gitname}-$(jq -r '.version' ${_gitname}/package.json).tgz

  mkdir -p "${pkgdir}"/usr/lib/node_modules
  rsync -av --exclude=.git ${_gitname} "${pkgdir}"/usr/lib/node_modules/
  install -Dm644 ${_gitname}/LICENSE "${pkgdir}"/usr/share/licenses/${pkgname}/LICENSE
}
