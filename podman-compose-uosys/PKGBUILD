# Maintainer: tinywrkb <tinywrkb@gmail.com>
# Contributor: Filipe La√≠ns (FFY00) <lains@archlinux.org>

# TODO: add unprivleged service with podman:podman user
_pkgname=podman-compose
pkgname=$_pkgname-uosys
pkgver=0.1.5.r99.g039fe30
_commit=039fe30a7096e622ddbc109778d9e60a8c8ba6b0
pkgrel=2
pkgdesc='A script to run docker-compose.yml using podman'
arch=('any')
url='https://github.com/containers/podman-compose'
license=('GPL2')
backup=('etc/conf.d/podman-compose')
depends=('python' 'python-yaml' 'podman')
makedepends=('git' 'python-setuptools')
conflicts=("$_pkgname")
provides=("$_pkgname")
source=("git+$url#commit=$_commit"
        'podman-compose.conf.d'
        'podman-compose.conf.d.user'
        'podman-compose@.service'
        'podman-compose@.service.user'
        'tmpfiles.d.conf')
sha256sums=('SKIP'
            'SKIP'
            'SKIP'
            'SKIP'
            'SKIP'
            'SKIP')

pkgver() {
  cd $_pkgname
  git describe --long | sed 's/^v//;s/\([^-]*-g\)/r\1/;s/-/./g'
}

build() {
  cd $_pkgname

  python setup.py build
}

package() {
  cd $_pkgname

  python setup.py install --root="$pkgdir" --optimize=1 --skip-build
  install -Dm644 ../podman-compose@.service "$pkgdir"/usr/lib/systemd/system/podman-compose@.service
  install -Dm644 ../podman-compose.conf.d "$pkgdir"/etc/conf.d/podman-compose
  install -Dm644 ../podman-compose@.service.user "$pkgdir"/usr/lib/systemd/user/podman-compose@.service
  install -Dm644 ../podman-compose.conf.d.user "$pkgdir"/usr/doc/podman-compose/user/podman-compose.conf.d

  # uosys-mods
  #install -dm755 "$pkgdir"/etc/podman/compose
  install -dm755 "$pkgdir"/etc/podman
  ln -s /var/etc/podman/compose "$pkgdir"/etc/podman/compose
  install -Dm644 ../tmpfiles.d.conf "$pkgdir"/usr/lib/tmpfiles.d/uosys-mods-podman-compose.conf
}

# vim:set ts=2 sw=2 et:
